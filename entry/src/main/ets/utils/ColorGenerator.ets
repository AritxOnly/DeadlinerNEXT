export interface ThemePalette {
  primary: string;    // ä¸»è‰² (å“ç‰Œè‰²)
  secondary: string;  // æ¬¡è¦è‰² (ä½é¥±å’Œï¼Œç”¨äºå®¹å™¨/èƒŒæ™¯)
  tertiary: string;   // ç¬¬ä¸‰è‰² (é€šå¸¸æ˜¯è¡¥è‰²æˆ–é‚»è¿‘è‰²ï¼Œç”¨äºå¼ºè°ƒ)
}

export interface ColorSwatch {
  color: string;
  isLight: boolean; // ç”¨äºåˆ¤æ–­æ–‡å­—é¢œè‰²åº”è¯¥æ˜¯é»‘è¿˜æ˜¯ç™½
}

export class ColorGenerator {

  /**
   * ğŸ¨ ç”Ÿæˆ [é²œè‰³/ç”ŸåŠ¨] æ–¹æ¡ˆ (ä»¿ Material 3 æ ‡å‡†)
   * @param hue è‰²ç›¸ (0-360)
   */
  static generateVibrant(hue: number): ThemePalette {
    // 1. Primary: é«˜é¥±å’Œï¼Œä¸­ç­‰äº®åº¦ (M3æ ‡å‡† Tone=40~50)
    // çœ‹èµ·æ¥æ·±é‚ƒã€ä¸“ä¸šï¼Œä¸æ˜¯åˆºçœ¼çš„è§å…‰è‰²
    const primary = ColorGenerator.hsvToHex(hue, 80, 80);

    // 2. Secondary: åŒè‰²ç›¸ï¼Œä½†æä½é¥±å’Œåº¦ï¼Œé«˜äº®åº¦ (ç”¨äºèƒŒæ™¯å®¹å™¨)
    // M3 çš„ Secondary é€šå¸¸æ˜¯â€œå¸¦ä¸€ç‚¹ç‚¹ä¸»è‰²è°ƒçš„ç°â€
    const secondary = ColorGenerator.hsvToHex(hue, 20, 95);

    // 3. Tertiary: è‰²ç›¸åç§» 60åº¦ (é‚»è¿‘è‰²) æˆ– 120åº¦ (å¯¹æ¯”è‰²)
    // M3 é»˜è®¤åç§» 60 åº¦ï¼Œé¥±å’Œåº¦é€‚ä¸­
    let tertiaryHue = (hue + 60) % 360;
    const tertiary = ColorGenerator.hsvToHex(tertiaryHue, 70, 85);

    return { primary, secondary, tertiary };
  }

  /**
   * ğŸŒ«ï¸ ç”Ÿæˆ [è«å…°è¿ª/ç»å…¸] æ–¹æ¡ˆ (ä½é¥±å’Œï¼Œé«˜çº§ç°)
   * @param hue è‰²ç›¸ (0-360)
   */
  static generateMorandi(hue: number): ThemePalette {
    // è«å…°è¿ªçš„æ ¸å¿ƒï¼šé™ä½é¥±å’Œåº¦ (S)ï¼Œå¹¶æ§åˆ¶äº®åº¦ (V) ä¸å¤ªé«˜ä¹Ÿä¸å¤ªä½ï¼Œ
    // è¥é€ å‡ºä¸€ç§â€œè’™äº†ä¸€å±‚ç°â€çš„è´¨æ„Ÿã€‚

    // 1. Primary: é¥±å’Œåº¦ç åˆ° 25% å·¦å³ï¼Œäº®åº¦é™ä½ï¼Œå˜å¾—æŸ”å’Œ
    const primary = ColorGenerator.hsvToHex(hue, 25, 75);

    // 2. Secondary: é¥±å’Œåº¦æä½ (10%)ï¼Œäº®åº¦æ‹‰é«˜ï¼Œæ¥è¿‘ç±³ç™½è‰²/ç°ç™½è‰²
    const secondary = ColorGenerator.hsvToHex(hue, 10, 92);

    // 3. Tertiary: åŒæ ·åç§»è‰²ç›¸ï¼Œä½†é¥±å’Œåº¦ä¹Ÿå‹ä½
    let tertiaryHue = (hue + 60) % 360;
    const tertiary = ColorGenerator.hsvToHex(tertiaryHue, 20, 80);

    return { primary, secondary, tertiary };
  }

  static generateSwatches(hue: number, type: 'morandi' | 'vibrant'): ColorSwatch[] {
    const swatches: ColorSwatch[] = [];
    const saturations = type === 'morandi' ? [20, 25, 30, 35, 40] : [60, 70, 80, 90, 100];
    const values = [85, 75, 65, 55, 45]; // ä¸åŒæ˜åº¦

    for (let i = 0; i < 5; i++) {
      swatches.push({
        color: ColorGenerator.hsvToHex(hue, saturations[i], values[i]),
        isLight: values[i] > 65 // ç®€å•çš„äº®åº¦åˆ¤æ–­
      });
    }
    return swatches;
  }

  /**
   * ç”Ÿæˆ 9 ä¸ªé¢œè‰²ï¼Œç”¨äº Grid å±•ç¤º
   * åŒ…å«ï¼šæ·¡é›…(Morandi)ã€æ ‡å‡†(Standard)ã€æµ“éƒ(Deep)
   */
  static generateGradientSwatches(hue: number): ColorSwatch[] {
    const swatches: ColorSwatch[] = [];

    // è¿™é‡Œçš„å‚æ•°ä½ å¯ä»¥å¾®è°ƒï¼Œå‡‘å¤Ÿ9ä¸ªå¥½çœ‹çš„é¢œè‰²
    // æ ¼å¼: [Saturation, Value]
    const configs = [
      [15, 95], [25, 90], [35, 85], // ç¬¬ä¸€è¡Œï¼šéå¸¸æµ…/è«å…°è¿ª
      [50, 90], [60, 85], [70, 80], // ç¬¬äºŒè¡Œï¼šé²œè‰³/ç”ŸåŠ¨
      [70, 60], [80, 50], [90, 40]  // ç¬¬ä¸‰è¡Œï¼šæ·±æ²‰/ä¸“ä¸š
    ];

    for (let conf of configs) {
      swatches.push({
        color: ColorGenerator.hsvToHex(hue, conf[0], conf[1]),
        isLight: conf[1] > 65 // äº®åº¦é«˜åˆ™æ–‡å­—é»‘ï¼Œåä¹‹ç™½
      });
    }
    return swatches;
  }

  /**
   * HSV è½¬ Hex è¾…åŠ©å‡½æ•°
   * @param h Hue 0-360
   * @param s Saturation 0-100
   * @param v Value 0-100
   */
  static hsvToHex(h: number, s: number, v: number): string {
    s /= 100;
    v /= 100;

    let c = v * s;
    let x = c * (1 - Math.abs(((h / 60) % 2) - 1));
    let m = v - c;

    let r = 0, g = 0, b = 0;

    if (0 <= h && h < 60) { r = c; g = x; b = 0; }
    else if (60 <= h && h < 120) { r = x; g = c; b = 0; }
    else if (120 <= h && h < 180) { r = 0; g = c; b = x; }
    else if (180 <= h && h < 240) { r = 0; g = x; b = c; }
    else if (240 <= h && h < 300) { r = x; g = 0; b = c; }
    else if (300 <= h && h < 360) { r = c; g = 0; b = x; }

    // è½¬ 0-255 å¹¶è½¬ Hex
    const toHex = (n: number) => {
      const hex = Math.round((n + m) * 255).toString(16);
      return hex.length === 1 ? '0' + hex : hex;
    };

    return `#FF${toHex(r)}${toHex(g)}${toHex(b)}`.toUpperCase();
  }
}