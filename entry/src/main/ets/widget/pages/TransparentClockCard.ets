import { HudWidgetData } from '../model/HudWidgetData'

@Entry
@Component
struct TransparentClockCard {
  @LocalStorageProp('hudData') data: HudWidgetData = new HudWidgetData();

  readonly COLOR_ACCENT: string = '#00ACC1';
  readonly COLOR_BRAND: string = '#80DEEA';

  build() {
    Stack() {
      // 1. èƒŒæ™¯é€æ˜

      // 2. å†…å®¹åŒºåŸŸ
      Column() {
        // --- ç¬¬ä¸€è¡Œï¼šæ—¥æœŸ & ä¸´è¿‘ä»»åŠ¡ (ä¿æŒä¸å˜) ---
        Row() {
          Text(this.data.dateStr)
            .fontSize(13)
            .fontColor(Color.White)
            .shadow(this.getTextShadow())
            .opacity(0.9)

          if (this.data.hasUrgent) {
            Text(' Â· ')
              .fontSize(13)
              .fontColor(Color.White)
              .shadow(this.getTextShadow())

            SymbolGlyph($r('sys.symbol.hourglass'))
              .fontSize(13)
              .fontColor([Color.White])
              .renderingStrategy(SymbolRenderingStrategy.MULTIPLE_OPACITY)
              .margin({ right: 4 })
              .shadow(this.getTextShadow())

            Text(this.data.urgentTaskName)
              .fontSize(13)
              .fontWeight(FontWeight.Medium)
              .fontColor(this.COLOR_BRAND)
              .shadow(this.getTextShadow(true))
              .maxLines(1)
              .textOverflow({ overflow: TextOverflow.Ellipsis })
              .layoutWeight(1)
          }
        }
        .width('100%')
        .alignItems(VerticalAlign.Center)

        // --- ç¬¬äºŒè¡Œï¼šç»Ÿè®¡æ¦‚è§ˆ (é‡ç‚¹ä¿®å¤) ---
        Row() {
          // ğŸ”´ ä¿®å¤ï¼šç›´æ¥å±•å¼€å†™é€»è¾‘ï¼Œç¡®ä¿ this.data.xxx èƒ½å¤Ÿè§¦å‘è§†å›¾åˆ·æ–°

          // 1. ä¸´è¿‘
          if (this.data.hasUrgent) {
            Row({ space: 2 }) {
              Text(`${this.data.imminentCount}`) // å¼ºåˆ¶è½¬å­—ç¬¦ä¸²
                .fontSize(13)
                .fontWeight(FontWeight.Bold)
                .fontColor('#FF8A80')
                .shadow(this.getTextShadow())
              Text('ä¸´è¿‘')
                .fontSize(12)
                .fontColor(Color.White)
                .opacity(0.7)
                .shadow(this.getTextShadow())
            }
            this.Divider()
          }

          // 2. å¾…åŠ (ä¿®å¤ç‚¹ï¼šä¸è¦é€šè¿‡ StatItem ä¼ å‚)
          Row({ space: 2 }) {
            Text(`${this.data.todoCount}`) // è¿™é‡Œç›´æ¥è¯»å– dataï¼Œä¸€å®šä¼šåˆ·æ–°
              .fontSize(13)
              .fontWeight(FontWeight.Bold)
              .fontColor(Color.White)
              .shadow(this.getTextShadow())
            Text('å¾…åŠ')
              .fontSize(12)
              .fontColor(Color.White)
              .opacity(0.7)
              .shadow(this.getTextShadow())
          }

          this.Divider()

          // 3. ä¹ æƒ¯ (ä¿®å¤ç‚¹ï¼šä¸è¦é€šè¿‡ StatItem ä¼ å‚)
          Row({ space: 2 }) {
            Text(`${this.data.habitCount}`) // è¿™é‡Œç›´æ¥è¯»å– dataï¼Œä¸€å®šä¼šåˆ·æ–°
              .fontSize(13)
              .fontWeight(FontWeight.Bold)
              .fontColor(Color.White)
              .shadow(this.getTextShadow())
            Text('ä¹ æƒ¯')
              .fontSize(12)
              .fontColor(Color.White)
              .opacity(0.7)
              .shadow(this.getTextShadow())
          }
        }
        .width('100%')
        .margin({ top: 6 })

        // --- ç¬¬ä¸‰è¡Œï¼šæ—¶é—´ ---
        Blank()

        TextClock()
          .fontSize(74)
          .fontWeight(FontWeight.Bold)
          .fontColor(Color.White)
          .shadow({
            radius: 15,
            color: 'rgba(0,0,0,0.3)',
            offsetY: 4
          })
          .margin({ bottom: -10, left: -4 })
      }
      .width('100%')
      .height('100%')
      .alignItems(HorizontalAlign.Start)
      .padding({ left: 16, right: 16, top: 16, bottom: 16 })
    }
    .width('100%')
    .height('100%')
  }

  @Builder
  Divider() {
    Text(' / ')
      .fontSize(10)
      .fontColor(Color.White)
      .opacity(0.4)
      .margin({ left: 4, right: 4 })
      .shadow(this.getTextShadow())
  }

  getTextShadow(isStrong: boolean = false): ShadowOptions {
    return {
      radius: isStrong ? 8 : 4,
      color: 'rgba(0,0,0,0.4)',
      offsetX: 0,
      offsetY: 1
    };
  }
}